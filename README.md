# Написание скриптов
<p>
    # Администрирование локальных, виртуальных и облачных серверов.<br>
    # Администрирование базы данных.<br>
    <strong>Task:</strong><br>
    Администрирование локальных, виртуальных и облачных серверов. Ошибка после ввода пароля в программе у всех пользователей - "Не отвечает программа"<br>
    ВНЕШНЯЯБАЗА2.exe не работает<br>
    На одном из объектов автоматизации второй раз за месяц происходит процесс переполнения внешней базы документооборота C:\ПУТЬКБАЗЕ\ВНЕШНЯЯБАЗА1.GDB. База данных увеличивается в размерах с 1.8 Гб до 115Гб за три дня. После проведения инженером филиала процедуры Бэкап/Рестор внешняя база возвращается к прежнему размеру. Данная проблема наблюдается второй раз за месяц с периодичностью в две недели.<br>
    <strong>Decision:</strong><br>
    Отключить службы Firebird, Сделать backup/restore базы ВНЕШНЯЯБАЗА1.GDB, запустив скрипты&nbsp;<br>
    1. backup.bat<br>
    2. restore.bat<br>
    после чего сохранится файл ВНЕШНЯЯБАЗА1.GDB в КУДАСОХРАНЯТЬИЗМЕНЕНИЯ. Файл заменить на файл в сервере, который занимал 120 гб. Посмотреть лог файлы:<br>
    1. retranslator.log<br>
    2. retranslator_2022-01-11_15-23-40-694.log<br>
    3. retranslator_2022-01-24_16-36-09-627.log<br>
    4. retranslator_2022-01-24_16-36-16-806.log<br>
    <strong>Decision:</strong><br>
    $ cat backup.bat<br>
    @ echo on<br>
    SET ISC_USER=ИМЯПОЛЬЗОВАТЕЛЯБАЗЫ<br>
    SET ISC_PASSWORD=ПАРОЛЬКБАЗЕ<br>
    SET dbpath=localhost:C:\ПУТЬКБАЗЕ\ВНЕШНЯЯБАЗА1.GDB<br>
    SET fbpath=C:\ПУТЬFIREBIRD\Firebird_1_5\bin\<br>
    SET bbpath=C:\КУДАСОХРАНЯТЬИЗМЕНЕНИЯ\<br>
    "%fbpath%gfix" -shut -force 5 "%dbpath%"<br>
    "%fbpath%gbak" -b -v -g -y "%bbpath%%date%.log" "%dbpath%" "%bbpath%ВНЕШНЯЯБАЗА1_%date%.gbk"<br>
    @ pause<br>
    $ cat restore.bat<br>
    @ echo on<br>
    SET ISC_USER=ИМЯПОЛЬЗОВАТЕЛЯБАЗЫ<br>
    SET ISC_PASSWORD=ПАРОЛЬКБАЗЕ<br>
    SET fbpath=C:\ПУТЬFIREBIRD\Firebird_1_5\bin\<br>
    SET bbpath=localhost:C:\КУДАСОХРАНЯТЬИЗМЕНЕНИЯ\<br>
    "%fbpath%gbak.exe" -c -v -r -y "c:\КУДАСОХРАНЯТЬИЗМЕНЕНИЯ\%date%_fix.log" "c:\КУДАСОХРАНЯТЬИЗМЕНЕНИЯ\ВНЕШНЯЯБАЗА1_backup.gbk" "%bbpath%ВНЕШНЯЯБАЗА1_fix.GDB"&nbsp;<br>
    @ pause<br>
    $ cat retranslator.log<br>
    ...<br>
    INF|09.12.2022 16:27:36 Сообщения в очереди "viv.client.КОДОА.1" отсутствуют<br>
    INF|09.12.2022 16:32:39 Отправка запроса id="ИДЕНТИФИКАТОРПРОЦЕССА1", type_id=ИДЕНТИФИКАТОРТИП ...<br>
    ERR|09.12.2022 16:33:37 Out of memory.<br>
    &nbsp;&nbsp;&nbsp; E.ClassName=EOutOfMemory<br>
    &nbsp;&nbsp;&nbsp; Sender.ClassName=TWorkThread<br>
    ...<br>
    INF|11.12.2022 22:28:27 Отправка запроса id="ИДЕНТИФИКАТОРПРОЦЕССА2", type_id=ИДЕНТИФИКАТОРТИП ...<br>
    ERR|11.12.2022 22:28:53 При отправке запроса id="ИДЕНТИФИКАТОРПРОЦЕССА2" произошла неустранимая ошибка чтения из БД, запрос отклонён. Текст ошибки:<br>
    &nbsp;&nbsp;&nbsp; Unsuccessful execution caused by a system error that precludes<br>
    &nbsp;&nbsp;&nbsp; successful execution of subsequent statements.<br>
    &nbsp;&nbsp;&nbsp; I/O error for file "C:\ПУТЬКБАЗЕ\ВНЕШНЯЯБАЗА1.GDB".<br>
    &nbsp;&nbsp;&nbsp; Error while trying to write to file.<br>
    &nbsp;&nbsp;&nbsp; Недостаточно места на диске.<br>
    ...<br>
    <strong>Decision:</strong><br>
    при обработке одного запроса id="ИДЕНТИФИКАТОРПРОЦЕССА1", type_id=ИДЕНТИФИКАТОРТИП происходит нехватка памяти, что далее приводит к сбою функционирования. Вероятно в запросе большое вложение. Для дальнейшего анализа смотрим БД ВНЕШНЯЯБАЗА2.gdb, в которой покажет технические ошибки состояния базы ВНЕШНЯЯБАЗА2.gdb.<br>
    Для их устранения также сделать бэкап/ресторе БД ВНЕШНЯЯБАЗА2.gdb. Далее понаблюдать за ситуацией с размером БД ВНЕШНЯЯБАЗА2.GDB, чтобы он весил не больше 19 Гб.<br>
    <strong>Task:</strong><br>Администрирование базы данных. После отключения света в здании служба OracleServiceНАЗВАНИЕСИСТЕМЫ не запускается. При подключении к БСР клиента на сервере выходит следующая ошибка:<br>ОШИБКА ORA-01033. ORACLE INITIALIZATION OR SHUTDOWN IN PROGRESS<br>Не помогает перезапуск службы ORACLE и перезагрузка сервера.<br>Также пробовали подключиться и настроить базу в командной строке через sql plus. После ввода команды выдает ошибку:<br>C:\&gt;sqlplus<br>Enter user-name: СОКРАЩЕННОЕОЕИМЯПОЛЬЗОВАТЕЛЯ as ПОЛНОЕИМЯПОЛЬЗОВАТЕЛЯ<br>SQL&gt; alter pluggable database all open;<br>alter pluggable database all open<br>*<br>ERROR at line 1:<br>ORA-00940: invalid ALTER command<br>Нужно сделать рестарт базы<br><strong>Decision:</strong><br>C:\&gt;sqlplus /nolog<br>SQL&gt; connect СОКРАЩЕННОЕОЕИМЯПОЛЬЗОВАТЕЛЯ/pass@НАЗВАНИЕСИСТЕМЫ as ПОЛНОЕИМЯПОЛЬЗОВАТЕЛЯ<br>ERROR:<br>ORA-01017: invalid username/password; logon denied<br>SQL&gt; conn СОКРАЩЕННОЕОЕИМЯПОЛЬЗОВАТЕЛЯ/oracle@НАЗВАНИЕСИСТЕМЫ as ПОЛНОЕИМЯПОЛЬЗОВАТЕЛЯ<br>SQL&gt; startup mount<br>ORA-01081: cannot start already-running ORACLE - shut it down first<br>SQL&gt; shutdown immediate<br>ORA-01109: database not open<br>Database dismounted.<br>ORACLE instance shut down.<br>SQL&gt; startup mount<br>SQL&gt; col file format a5;<br>SQL&gt; col name format a20;<br>SQL&gt; col status format a10;<br>SQL&gt; select file#,name,status from v$datafile;<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>   1 C:\ORACLE\ORADATA\GA SYSTEM<br> S\SYSTEM01.DBF<br>   2 C:\ORACLE\ORADATA\GA ONLINE<br> S\UNDOTBS01.DBF<br>   3 C:\ORACLE\ORADATA\GA ONLINE<br> S\CWMLITE01.DBF<br>   4 C:\ORACLE\ORADATA\GA ONLINE<br> S\DRSYS01.DBF<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>   5 C:\ORACLE\ORADATA\GA ONLINE<br> S\EXAMPLE01.DBF<br>   6 C:\ORACLE\ORADATA\GA ONLINE<br> S\INDX01.DBF<br>   7 C:\ORACLE\ORADATA\GA ONLINE<br> S\ODM01.DBF<br>   8 C:\ORACLE\ORADATA\GA ONLINE<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br> S\TOOLS01.DBF<br>   9 C:\ORACLE\ORADATA\GA ONLINE<br> S\USERS01.DBF<br>  10 C:\ORACLE\ORADATA\GA ONLINE<br> S\XDB01.DBF<br>  11 C:\ORACLE\ORADATA\GA ONLINE<br> S\TBLS_BSR.ORA<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>  12 C:\ORACLE\ORADATA\GA ONLINE<br> S\DELO_D.DAT<br>  13 C:\ORACLE\ORADATA\GA ONLINE<br> S\DELO_I.DAT<br>  14 C:\ORACLE\ORADATA\GA ONLINE<br> S\DELO_O.DAT<br>  15 C:\ORACLE\ORADATA\GA ONLINE<br> S\KADR_D.DAT<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>  16 C:\ORACLE\ORADATA\GA ONLINE<br> S\KADR_I.DAT<br>  17 C:\ORACLE\ORADATA\GA ONLINE<br> S\KADR_O.DAT<br>  18 C:\ORACLE\ORADATA\GA ONLINE<br> S\ARCH_D.DAT<br>  19 C:\ORACLE\ORADATA\GA ONLINE<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br> S\ARCH_I.DAT<br>  20 C:\ORACLE\ORADATA\GA ONLINE<br> S\EDS_D.DAT<br>  21 C:\ORACLE\ORADATA\GA ONLINE<br> S\EDS_I.DAT<br>  22 C:\ORACLE\ORADATA\GA ONLINE<br> S\EDS_O.DAT<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>  23 C:\ORACLE\ORADATA\GA ONLINE<br> S\.ORA<br>  24 C:\ORACLE\ORADATA\GA SYSTEM<br> S\SYSTEM02.ORA<br>  25 C:\ORACLE\ORADATA\GA SYSTEM<br> S\SYSTEM03.ORA<br>25 rows selected.<br>SQL&gt; recover datafile 1;<br>SQL&gt; select file#,name,status from v$datafile;<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>   1 C:\ORACLE\ORADATA\GA SYSTEM<br> S\SYSTEM01.DBF<br>   2 C:\ORACLE\ORADATA\GA ONLINE<br> S\UNDOTBS01.DBF<br>   3 C:\ORACLE\ORADATA\GA ONLINE<br> S\CWMLITE01.DBF<br>   4 C:\ORACLE\ORADATA\GA ONLINE<br> S\DRSYS01.DBF<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>   5 C:\ORACLE\ORADATA\GA ONLINE<br> S\EXAMPLE01.DBF<br>   6 C:\ORACLE\ORADATA\GA ONLINE<br> S\INDX01.DBF<br>   7 C:\ORACLE\ORADATA\GA ONLINE<br> S\ODM01.DBF<br>   8 C:\ORACLE\ORADATA\GA ONLINE<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br> S\TOOLS01.DBF<br>   9 C:\ORACLE\ORADATA\GA ONLINE<br> S\USERS01.DBF<br>  10 C:\ORACLE\ORADATA\GA ONLINE<br> S\XDB01.DBF<br>  11 C:\ORACLE\ORADATA\GA ONLINE<br> S\TBLS_BSR.ORA<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>  12 C:\ORACLE\ORADATA\GA ONLINE<br> S\DELO_D.DAT<br>  13 C:\ORACLE\ORADATA\GA ONLINE<br> S\DELO_I.DAT<br>  14 C:\ORACLE\ORADATA\GA ONLINE<br> S\DELO_O.DAT<br>  15 C:\ORACLE\ORADATA\GA ONLINE<br> S\KADR_D.DAT<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>  16 C:\ORACLE\ORADATA\GA ONLINE<br> S\KADR_I.DAT<br>  17 C:\ORACLE\ORADATA\GA ONLINE<br> S\KADR_O.DAT<br>  18 C:\ORACLE\ORADATA\GA ONLINE<br> S\ARCH_D.DAT<br>  19 C:\ORACLE\ORADATA\GA ONLINE<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br> S\ARCH_I.DAT<br>  20 C:\ORACLE\ORADATA\GA ONLINE<br> S\EDS_D.DAT<br>  21 C:\ORACLE\ORADATA\GA ONLINE<br> S\EDS_I.DAT<br>  22 C:\ORACLE\ORADATA\GA ONLINE<br> S\EDS_O.DAT<br> FILE# NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS<br>---------- -------------------- ----------<br>  23 C:\ORACLE\ORADATA\GA ONLINE<br> S\.ORA<br>  24 C:\ORACLE\ORADATA\GA SYSTEM<br> S\SYSTEM02.ORA<br>  25 C:\ORACLE\ORADATA\GA SYSTEM<br> S\SYSTEM03.ORA<br>25 rows selected.<br>SQL&gt; alter database open;<br><strong>Task:</strong><br>Администрирование базы данных. В ПОДСИСТЕМА не грузятся на сайт 200 дел. Смотрим лог файл:<br>$ cat importer.log.xml<br>...<br>&lt;Error ReadableDateTime="23.01.2023 12:51:31" FileTimeUtc="133189230912753002"&gt;<br>&lt;Message&gt;Îøèáêà ïðè âûïîëíåíèè çàïðîñà:<br>BEGIN BSR.PK_BSR.CTX_Sinxronize; END;<br>Òåêñò îøèáêè:<br>ORA-20000: Oracle Text error:<br>DRG-50857: oracle error in dreii0fsh<br>ORA-01653: unable to extend table BSR.DR$CTX_SRH$I by 8192 in tablespace SYSTEM<br>ORA-06512: at "CTXSYS.DRUE", line 157<br>ORA-06512: at "CTXSYS.CTX_DDL", line 1328<br>ORA-06512: at "BSR.PK_BSR", line 313<br>ORA-06512: at line 1<br>&lt;/Message&gt;<br>&lt;Details&gt;System.Exception: Îøèáêà ïðè âûïîëíåíèè çàïðîñà:<br>BEGIN BSR.PK_BSR.CTX_Sinxronize; END;<br>Òåêñò îøèáêè:<br>ORA-20000: Oracle Text error:<br>DRG-50857: oracle error in dreii0fsh<br>ORA-01653: unable to extend table BSR.DR$CTX_SRH$I by 8192 in tablespace SYSTEM<br>ORA-06512: at "CTXSYS.DRUE", line 157<br>ORA-06512: at "CTXSYS.CTX_DDL", line 1328<br>ORA-06512: at "BSR.PK_BSR", line 313<br>ORA-06512: at line 1<br>&#xD;<br> â ImpFunktions.Database.DbaseIns(String cmdString)&#xD;<br> â ImpFunktions.Importer.synchronize()&lt;/Details&gt;<br>&lt;/Error&gt;<br>пуск - все программы - oracle orahome92 - enterprize manager console - ок - databases - gas -  system - oracle - storage - tablespaces<br>Проблема из за того, что у Вас закончилось свободное оракловое ТП SYSTEM и Tbls_bsr, которые надо увеличить вручную путем добавления DATA файла. "Флаг" в чек боксе Авторасширение не поможет.<br><strong>Decision:</strong><br>Обязательно делайте бэкап перед любыми действиями с базой. Дважды щелкните ЛКМ табличное пространство SYSTEM и добавьте в него второй файл. Oracle автоматически подставит расширение ORA. Исправьте его на DBF перед сохранением. <br>system - add datafile - name - SYSTEM04.ORA - file size - 4096MB - storage - automatically extend datafile when full - increment - 10240KB - value - 32767MB - ok - перезапустить службу BSRImport - В админке обновлять авоматический импорт из СДП<br><strong>Task:</strong><br>Администрирование базы данных. Можно сделать это в командной строке, добавив дополнительный файл данных к табличному пространству и изменив размер текущего файла данных, Некоторые версии Oracle не позволяют такого!<br><strong>Decision:</strong><br>ALTER TABLESPACE USERS ADD DATAFILE '/u01/oradata/orcl/users02.dbf' size 25m;<br>ALTER DATABASE DATAFILE '/u01/oradata/orcl/users01.dbf' resize 50M;<br>Необходимо добавить новый датафайл к табличному пространству SYSTEM.
</p>